Namespaces:
    =: io.murano.services.windows.activeDirectory
    std: io.murano
    sys: io.murano.system
    win: io.murano.services.windows

Name: PrimaryController

Extends: Controller

Properties:

  dnsIp:
    Contract: $.string()

Workflow:
  initialize:
    Body:
      - $.super($.initialize())
      - $.domain: $.find(ActiveDirectory).require()

  deploy:
    Arguments:
    Body:
      - $.debugPrint('Deploying Primary Controller for domain {0}'.format($this.domain.name))
      - $.super($.deploy())
      - $resources: new(io.murano.system.Resources)
      - $template: $resources.json('CreatePrimaryDC.template').bind(dict(
            domain => $.domain.name,
            recoveryPassword => $.recoveryPassword
          ))
      - $.host.agent.call($template, $resources)

      - $template: $resources.json('AskDnsIp.template')
      - $.dnsIp: $.host.agent.call($template, $resources)[0]
